# üöÄ Restify Route Generator

Auto-generate type-safe routes from file structure, inspired by TanStack Router.

## Overview

The Restify Route Generator automatically scans your `api/` directory and generates type-safe route definitions with full TypeScript support.

## File-Based Routing

Create API endpoints using file and folder structure:

```
api/
  users.ts              ‚Üí /users
  users/$id.ts          ‚Üí /users/:id
  posts/
    $postId/
      comments.ts       ‚Üí /posts/:postId/comments
      $commentId.ts     ‚Üí /posts/:postId/comments/:commentId
```

### Dynamic Parameters

Use `$` prefix for dynamic route parameters:

- `$id` ‚Üí `:id`
- `$userId` ‚Üí `:userId`
- `$postId` ‚Üí `:postId`

## Configuration

Create `restify.config.json` in your project root:

```json
{
  "rootFolder": "src/api",
  "outputFile": "api-routes.gen.ts"
}
```

**Quick setup:**
```bash
npm run gen:init
```

üìñ [Full Configuration Guide](./CONFIG.md)

## Usage

### CLI Commands

```bash
# Create new API file with template
npm run gen:create -- products
npm run gen:create -- products/\$id
npm run gen:create -- posts/\$postId/comments

# Generate routes once
npm run gen

# Watch mode (auto-regenerate on file changes)
npm run gen:watch

# With custom options
npx restify-gen create products --dir ./api
npx restify-gen --dir ./api --output ./api-routes.gen.ts
npx restify-gen --watch --dir ./api
```

### CLI Options

- `-d, --dir` - API directory to scan (default: `./api`)
- `-o, --output` - Output file path (default: `./api-routes.gen.ts`)
- `-w, --watch` - Watch mode for auto-regeneration
- `-c, --create` - Create new API file with template
- `create <path>` - Create new API file (alternative syntax)

## Quick Start

### 1. Create API file with template

```bash
# Generate a new API endpoint file
npm run gen:create -- users
```

This automatically generates:

**api/users.ts**
```typescript
import { GET, POST, Body, Logger } from '../lib/index.ts';
import { Restify } from '../lib/Restify.ts';

/**
 * API endpoint for /users
 * Auto-generated by restify-gen
 */
export class UsersApi extends Restify {
  @GET("")
  @Logger()
  async get() {
    // GET /users
    return {
      data: { message: "Hello from /users" }
    };
  }

  @POST("")
  @Logger()
  async create(@Body() body: unknown) {
    // POST /users
    return {
      data: { message: "Created", body }
    };
  }
}
```

### 2. For dynamic routes

```bash
npm run gen:create -- users/\$id
```

Generates with automatic path parameter handling:

**api/users/$id.ts**
```typescript
export class ByIdApi extends Restify {
  @GET("")
  @Logger()
  async get(@Path("id") id: string) {
    // GET /users/:id
    return {
      data: { message: "Hello from /users/:id" }
    };
  }
}
```

## Example

### 1. Create API endpoints (manual)

**api/users.ts**
```typescript
import { GET, POST, Body, Logger } from 'restify';
import { Restify } from 'restify';

export class UsersApi extends Restify {
  @GET("")
  @Logger()
  async getUsers() {
    return { data: users };
  }

  @POST("")
  @Logger()
  async createUser(@Body() dto: CreateUserDto) {
    return { data: newUser };
  }
}
```

**api/users/$id.ts**
```typescript
import { GET, DELETE, Path, Logger } from 'restify';
import { Restify } from 'restify';

export class UserByIdApi extends Restify {
  @GET("")
  @Logger()
  async getUser(@Path("id") id: string) {
    return { data: user };
  }

  @DELETE("")
  @Logger()
  async deleteUser(@Path("id") id: string) {
    return { data: { success: true } };
  }
}
```

### 2. Generate routes

```bash
npm run gen
```

### 3. Generated output

**api-routes.gen.ts**
```typescript
/**
 * üöÄ Auto-generated by restify-gen
 * Do not edit manually
 */

import * as Route0 from './api/users.ts';
import * as Route1 from './api/users/$id.ts';

export const apiRoutes = {
  '/users': { module: Route0, params: [] },
  '/users/:id': { module: Route1, params: ['id'] }
} as const;

export type ApiRoutes = typeof apiRoutes;

export type RoutePath =
  | '/users'
  | '/users/:id';

export type RouteParams = {
  '/users/:id': { id: string };
};

export type RouteParamsFor<T extends RoutePath> = T extends keyof RouteParams
  ? RouteParams[T]
  : Record<string, never>;
```

## Benefits

‚úÖ **Type Safety** - Full TypeScript support with autocomplete  
‚úÖ **Auto-Generation** - Routes update automatically with watch mode  
‚úÖ **Template Generation** - New files automatically get boilerplate code  
‚úÖ **Convention over Configuration** - File structure defines routes  
‚úÖ **Developer Experience** - Similar to TanStack Router, Next.js, and Nuxt  
‚úÖ **Zero Overhead** - Generation happens at build time

## Watch Mode Auto-Generation

In watch mode, when you create a new empty file, the generator automatically fills it with a template:

```bash
# Start watch mode
npm run gen:watch

# In another terminal, create empty file
touch api/orders.ts

# Template is automatically generated! ‚ú®
```

The watcher detects:
- ‚úÖ New file creation
- ‚úÖ File modifications
- ‚úÖ File deletion
- ‚úÖ Nested directory changes

And automatically:
1. Generates template for new files
2. Updates route definitions
3. Regenerates type definitions

## Integration with Dev Workflow

Add to your `package.json` scripts:

```json
{
  "scripts": {
    "dev": "concurrently \"npm run gen:watch\" \"vite\"",
    "build": "npm run gen && tsc && vite build"
  }
}
```

Or with husky pre-commit:

```bash
#!/usr/bin/env sh
npm run gen
git add api-routes.gen.ts
```

## Advanced Examples

### Nested Resources

```
api/
  organizations/
    $orgId/
      teams/
        $teamId/
          members.ts    ‚Üí /organizations/:orgId/teams/:teamId/members
```

### Multiple HTTP Methods

Each API class can handle multiple HTTP methods on the same route:

```typescript
export class UserByIdApi extends Restify {
  @GET("")
  async getUser(@Path("id") id: string) { }

  @PUT("")
  async updateUser(@Path("id") id: string, @Body() dto: UpdateUserDto) { }

  @DELETE("")
  async deleteUser(@Path("id") id: string) { }
}
```

## Comparison with Other Frameworks

| Feature | Restify Gen | TanStack Router | Next.js App Router |
|---------|-------------|-----------------|-------------------|
| File-based | ‚úÖ | ‚úÖ | ‚úÖ |
| Type-safe | ‚úÖ | ‚úÖ | ‚úÖ |
| Auto-gen | ‚úÖ | ‚úÖ | ‚ùå |
| Backend | ‚úÖ | ‚ùå | ‚úÖ |
| Watch mode | ‚úÖ | ‚úÖ | ‚úÖ |

## Troubleshooting

### Routes not generating

1. Ensure files end with `.ts`
2. Check that directory exists
3. Verify file names don't contain spaces

### Watch mode not working

1. Check file permissions
2. Ensure directory is not in `.gitignore`
3. Try running without `--watch` first

## Contributing

See main project README for contribution guidelines.
